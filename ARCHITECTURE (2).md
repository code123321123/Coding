# High-Performance Data Comparison Tool - Architecture Document

## Executive Summary

This document describes the architecture for a high-performance data comparison tool designed to compare **30+ million records** across Oracle databases in **under 3 hours**. The tool identifies column-level differences between source and target tables and generates detailed reports with mismatched values highlighted.

---

## Table of Contents

1. [Problem Statement](#problem-statement)
2. [Solution Overview](#solution-overview)
3. [Architecture Diagram](#architecture-diagram)
4. [Component Details](#component-details)
5. [Data Flow](#data-flow)
6. [Database Schema](#database-schema)
7. [Key Algorithms](#key-algorithms)
8. [Performance Optimizations](#performance-optimizations)
9. [Configuration](#configuration)
10. [API Reference](#api-reference)
11. [Deployment Guide](#deployment-guide)
12. [Monitoring & Troubleshooting](#monitoring--troubleshooting)

---

## Problem Statement

### Current Challenges
- Comparing two large tables with **30 million records** each
- Tables have **700+ columns** including CLOB/BLOB types
- Current approach using temp tables and hash takes **3+ hours for just 300K records**
- Need to identify exact column-level differences for mismatched records
- Output must be in Excel format with **red highlighting** for mismatched values

### Requirements
| Requirement | Specification |
|-------------|---------------|
| Records to compare | 30 million |
| Number of columns | 700+ |
| Target completion time | < 3 hours |
| Join key | `as_of` + `dataset_id` + `posn_id` |
| Duplicate handling | Hash-based matching for duplicate `posn_id` |
| NULL comparison | NULL = NULL is a **match** |
| Empty string vs NULL | **Mismatch** |
| Numeric precision | 5 decimal places |
| Threshold | Stop if mismatch > X% (configurable, default 30%) |
| Output format | CSV (large) / Excel (with red highlighting) |
| Notification | Email with download URL |

---

## Solution Overview

### Two-Phase Comparison Strategy

Instead of comparing all 30M records column-by-column (which would be extremely slow), we use a **two-phase approach**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         TWO-PHASE COMPARISON STRATEGY                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  PHASE 1: HASH-BASED FILTERING                                              â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                            â”‚
â”‚  â€¢ Compute SHA256 hash of ALL columns per row                               â”‚
â”‚  â€¢ Compare hashes (fast integer comparison)                                 â”‚
â”‚  â€¢ Identify ~1-30% mismatched records                                       â”‚
â”‚  â€¢ Time: ~45-60 minutes for 30M records                                     â”‚
â”‚                                                                             â”‚
â”‚  PHASE 2: COLUMN-LEVEL EXTRACTION                                           â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                            â”‚
â”‚  â€¢ Fetch ONLY mismatched records (not all 30M)                              â”‚
â”‚  â€¢ Stream to CSV/Excel with column comparison                               â”‚
â”‚  â€¢ Apply red highlighting to mismatched cells                               â”‚
â”‚  â€¢ Time: ~60-90 minutes for 9M mismatched records (30%)                     â”‚
â”‚                                                                             â”‚
â”‚  TOTAL: ~2-2.5 hours vs 10+ hours with naive approach                       â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Technology Stack

| Layer | Technology | Purpose |
|-------|------------|---------|
| Database | Oracle 12c+ | Hash computation, parallel execution |
| Backend | Java 17 + Spring Boot 3.x | Orchestration, streaming |
| Connection Pool | HikariCP | High-performance JDBC |
| Excel Generation | Apache POI (SXSSF) | Streaming Excel writer |
| Email | Spring Mail | Notification delivery |

---

## Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    SYSTEM ARCHITECTURE                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚   UI/API    â”‚         â”‚                    JAVA APPLICATION                      â”‚  â”‚
â”‚   â”‚  (Client)   â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â”‚  â”‚              ComparisonController                   â”‚â”‚  â”‚
â”‚          â”‚                â”‚  â”‚  â€¢ POST /api/v1/comparison/start                    â”‚â”‚  â”‚
â”‚          â”‚ HTTP           â”‚  â”‚  â€¢ GET  /api/v1/comparison/status/{jobId}           â”‚â”‚  â”‚
â”‚          â”‚                â”‚  â”‚  â€¢ GET  /api/v1/comparison/download/{jobId}         â”‚â”‚  â”‚
â”‚          â–¼                â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚                        â”‚                                 â”‚  â”‚
â”‚   â”‚   REST API  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â–¼                                 â”‚  â”‚
â”‚   â”‚  (Spring)   â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  â”‚              ComparisonService                      â”‚â”‚  â”‚
â”‚                           â”‚  â”‚  â€¢ initializeJob()      - Create job record         â”‚â”‚  â”‚
â”‚                           â”‚  â”‚  â€¢ runHashComparison()  - Call PL/SQL package       â”‚â”‚  â”‚
â”‚                           â”‚  â”‚  â€¢ extractDifferences() - Stream mismatched rows    â”‚â”‚  â”‚
â”‚                           â”‚  â”‚  â€¢ sendNotification()   - Email results             â”‚â”‚  â”‚
â”‚                           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”‚
â”‚                           â”‚                        â”‚                                 â”‚  â”‚
â”‚                           â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚  â”‚
â”‚                           â”‚          â–¼             â–¼             â–¼                  â”‚  â”‚
â”‚                           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚  â”‚
â”‚                           â”‚  â”‚  Streaming  â”‚ â”‚   Email   â”‚ â”‚  HikariCP â”‚            â”‚  â”‚
â”‚                           â”‚  â”‚ExportServiceâ”‚ â”‚  Service  â”‚ â”‚Conn. Pool â”‚            â”‚  â”‚
â”‚                           â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜            â”‚  â”‚
â”‚                           â”‚         â”‚              â”‚             â”‚                   â”‚  â”‚
â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                     â”‚              â”‚             â”‚                      â”‚
â”‚                                     â–¼              â–¼             â–¼                      â”‚
â”‚                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                           â”‚  CSV/Excel  â”‚   â”‚   SMTP    â”‚  â”‚     ORACLE DATABASE     â”‚ â”‚
â”‚                           â”‚   Output    â”‚   â”‚  Server   â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚                           â”‚   Files     â”‚   â”‚           â”‚  â”‚  â”‚ DC_COMPARISON_PKG â”‚  â”‚ â”‚
â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â€¢ Parallel Hash  â”‚  â”‚ â”‚
â”‚                                                            â”‚  â”‚  â€¢ Hash Compare   â”‚  â”‚ â”‚
â”‚                                                            â”‚  â”‚  â€¢ Threshold Chk  â”‚  â”‚ â”‚
â”‚                                                            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚                                                            â”‚            â”‚            â”‚ â”‚
â”‚                                                            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚                                                            â”‚  â”‚   TEMP TABLES     â”‚  â”‚ â”‚
â”‚                                                            â”‚  â”‚  â€¢ dc_hash_source â”‚  â”‚ â”‚
â”‚                                                            â”‚  â”‚  â€¢ dc_hash_target â”‚  â”‚ â”‚
â”‚                                                            â”‚  â”‚  â€¢ dc_mismatch_*  â”‚  â”‚ â”‚
â”‚                                                            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚                                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Component Details

### 1. Oracle PL/SQL Package (`DC_COMPARISON_PKG`)

The core comparison logic runs **inside Oracle** for maximum performance.

```sql
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DC_COMPARISON_PKG                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  FUNCTIONS:                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                 â”‚
â”‚  â€¢ init_comparison_job()     - Create job record, return job_id             â”‚
â”‚  â€¢ generate_job_id()         - Generate unique job identifier               â”‚
â”‚  â€¢ get_common_columns()      - Find columns present in both tables          â”‚
â”‚  â€¢ generate_hash_sql()       - Build dynamic SQL for hash computation       â”‚
â”‚  â€¢ normalize_value()         - Handle NULL, precision, data types           â”‚
â”‚                                                                             â”‚
â”‚  PROCEDURES:                                                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                â”‚
â”‚  â€¢ run_comparison()          - Main entry point, orchestrates all phases    â”‚
â”‚  â€¢ compute_hashes_parallel() - Parallel hash computation using              â”‚
â”‚                                DBMS_PARALLEL_EXECUTE                        â”‚
â”‚  â€¢ compare_hashes()          - Join hash tables, identify mismatches        â”‚
â”‚  â€¢ cleanup_job()             - Remove temp data after completion            â”‚
â”‚  â€¢ log_message()             - Audit logging                                â”‚
â”‚  â€¢ update_job_status()       - Status management                            â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Java Services

#### ComparisonService
```java
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ComparisonService                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  @Async                                                                     â”‚
â”‚  executeComparison(ComparisonRequest request)                               â”‚
â”‚  â”‚                                                                          â”‚
â”‚  â”œâ”€â”€ 1. initializeJob()         â†’ Call PL/SQL init_comparison_job()        â”‚
â”‚  â”‚                                                                          â”‚
â”‚  â”œâ”€â”€ 2. runHashComparison()     â†’ Call PL/SQL run_comparison()             â”‚
â”‚  â”‚       â”‚                                                                  â”‚
â”‚  â”‚       â””â”€â”€ Returns: thresholdExceeded, mismatchCount, mismatchPct        â”‚
â”‚  â”‚                                                                          â”‚
â”‚  â”œâ”€â”€ 3. IF thresholdExceeded    â†’ STOP, send alert email                   â”‚
â”‚  â”‚                                                                          â”‚
â”‚  â”œâ”€â”€ 4. extractDifferences()    â†’ Stream mismatched records to CSV/Excel   â”‚
â”‚  â”‚       â”‚                                                                  â”‚
â”‚  â”‚       â””â”€â”€ Uses StreamingExportService                                   â”‚
â”‚  â”‚                                                                          â”‚
â”‚  â”œâ”€â”€ 5. updateJobStatus()       â†’ Mark job as COMPLETED                    â”‚
â”‚  â”‚                                                                          â”‚
â”‚  â””â”€â”€ 6. sendNotification()      â†’ Email with download link                 â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### StreamingExportService
```java
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       StreamingExportService                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  KEY FEATURES:                                                              â”‚
â”‚  â€¢ Streaming JDBC cursor (fetchSize=10000)                                  â”‚
â”‚  â€¢ BufferedWriter with 1MB buffer for CSV                                   â”‚
â”‚  â€¢ SXSSFWorkbook for Excel (only 1000 rows in memory)                       â”‚
â”‚  â€¢ Auto-creates new sheets when rows > 1M                                   â”‚
â”‚  â€¢ Red highlighting for mismatched cells                                    â”‚
â”‚                                                                             â”‚
â”‚  METHODS:                                                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                  â”‚
â”‚  â€¢ exportMismatchesToCsv()    - High-performance CSV export                 â”‚
â”‚  â€¢ exportMismatchesToExcel()  - Excel with formatting                       â”‚
â”‚  â€¢ buildExtractionSql()       - Dynamic SQL for fetching mismatches         â”‚
â”‚  â€¢ valuesEqual()              - Compare with precision/NULL handling        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    DATA FLOW DIAGRAM                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                         â”‚
â”‚  USER INPUT                                                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                             â”‚
â”‚  {                                                                                      â”‚
â”‚    sourceTable: "SCHEMA.POSITIONS",                                                     â”‚
â”‚    targetTable: "SCHEMA.POSITIONS@TARGET_DB",                                           â”‚
â”‚    sourceAsOf: "2024-03-31",                                                            â”‚
â”‚    targetAsOf: "2024-03-31",                                                            â”‚
â”‚    sourceDatasetId: "14_03312",                                                         â”‚
â”‚    targetDatasetId: "14_03312",                                                         â”‚
â”‚    thresholdPercent: 30,                                                                â”‚
â”‚    userEmail: "analyst@company.com"                                                     â”‚
â”‚  }                                                                                      â”‚
â”‚         â”‚                                                                               â”‚
â”‚         â–¼                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ PHASE 1: PARALLEL HASH COMPUTATION                                               â”‚   â”‚
â”‚  â”‚                                                                                   â”‚   â”‚
â”‚  â”‚  SOURCE TABLE (28M rows)              TARGET TABLE (28M rows)                    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚   â”‚
â”‚  â”‚  â”‚ posn_id â”‚ col1..700 â”‚              â”‚ posn_id â”‚ col1..700 â”‚                    â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚   â”‚
â”‚  â”‚  â”‚ 123     â”‚ ...       â”‚              â”‚ 123     â”‚ ...       â”‚                    â”‚   â”‚
â”‚  â”‚  â”‚ 456     â”‚ ...       â”‚              â”‚ 456     â”‚ ...       â”‚                    â”‚   â”‚
â”‚  â”‚  â”‚ ...     â”‚ ...       â”‚              â”‚ ...     â”‚ ...       â”‚                    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚   â”‚
â”‚  â”‚         â”‚                                    â”‚                                    â”‚   â”‚
â”‚  â”‚         â”‚ DBMS_PARALLEL_EXECUTE              â”‚ DBMS_PARALLEL_EXECUTE             â”‚   â”‚
â”‚  â”‚         â”‚ (16 parallel threads)              â”‚ (16 parallel threads)             â”‚   â”‚
â”‚  â”‚         â”‚                                    â”‚                                    â”‚   â”‚
â”‚  â”‚         â–¼                                    â–¼                                    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚   â”‚
â”‚  â”‚  â”‚   DC_HASH_SOURCE    â”‚              â”‚   DC_HASH_TARGET    â”‚                    â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚   â”‚
â”‚  â”‚  â”‚ posn_id â”‚ row_hash  â”‚              â”‚ posn_id â”‚ row_hash  â”‚                    â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚   â”‚
â”‚  â”‚  â”‚ 123     â”‚ 0xA1B2... â”‚              â”‚ 123     â”‚ 0xA1B2... â”‚ â† Same hash       â”‚   â”‚
â”‚  â”‚  â”‚ 456     â”‚ 0xC3D4... â”‚              â”‚ 456     â”‚ 0xE5F6... â”‚ â† Different!      â”‚   â”‚
â”‚  â”‚  â”‚ 789     â”‚ 0xG7H8... â”‚              â”‚ (none)  â”‚           â”‚ â† Missing         â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚   â”‚
â”‚  â”‚                                                                                   â”‚   â”‚
â”‚  â”‚  Time: ~30-45 minutes                                                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â”‚                                                                               â”‚
â”‚         â–¼                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ PHASE 2: HASH COMPARISON                                                         â”‚   â”‚
â”‚  â”‚                                                                                   â”‚   â”‚
â”‚  â”‚  SELECT s.posn_id, 'HASH_MISMATCH'                                               â”‚   â”‚
â”‚  â”‚  FROM dc_hash_source s                                                           â”‚   â”‚
â”‚  â”‚  JOIN dc_hash_target t ON s.posn_id = t.posn_id                                  â”‚   â”‚
â”‚  â”‚  WHERE s.row_hash != t.row_hash                                                  â”‚   â”‚
â”‚  â”‚                                                                                   â”‚   â”‚
â”‚  â”‚  UNION ALL                                                                        â”‚   â”‚
â”‚  â”‚                                                                                   â”‚   â”‚
â”‚  â”‚  SELECT s.posn_id, 'MISSING_IN_TARGET'                                           â”‚   â”‚
â”‚  â”‚  FROM dc_hash_source s                                                           â”‚   â”‚
â”‚  â”‚  WHERE NOT EXISTS (SELECT 1 FROM dc_hash_target t WHERE t.posn_id = s.posn_id)   â”‚   â”‚
â”‚  â”‚                                                                                   â”‚   â”‚
â”‚  â”‚  UNION ALL                                                                        â”‚   â”‚
â”‚  â”‚                                                                                   â”‚   â”‚
â”‚  â”‚  SELECT t.posn_id, 'MISSING_IN_SOURCE'                                           â”‚   â”‚
â”‚  â”‚  FROM dc_hash_target t                                                           â”‚   â”‚
â”‚  â”‚  WHERE NOT EXISTS (SELECT 1 FROM dc_hash_source s WHERE s.posn_id = t.posn_id)   â”‚   â”‚
â”‚  â”‚                                                                                   â”‚   â”‚
â”‚  â”‚         â”‚                                                                         â”‚   â”‚
â”‚  â”‚         â–¼                                                                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚   â”‚
â”‚  â”‚  â”‚       DC_MISMATCH_KEYS              â”‚                                         â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                         â”‚   â”‚
â”‚  â”‚  â”‚ posn_id â”‚ mismatch_type             â”‚                                         â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                         â”‚   â”‚
â”‚  â”‚  â”‚ 456     â”‚ HASH_MISMATCH             â”‚                                         â”‚   â”‚
â”‚  â”‚  â”‚ 789     â”‚ MISSING_IN_TARGET         â”‚                                         â”‚   â”‚
â”‚  â”‚  â”‚ 999     â”‚ MISSING_IN_SOURCE         â”‚                                         â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚   â”‚
â”‚  â”‚                                                                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚   â”‚
â”‚  â”‚  â”‚ THRESHOLD CHECK                     â”‚                                         â”‚   â”‚
â”‚  â”‚  â”‚ mismatch_pct = 8.4M / 28M = 30%     â”‚                                         â”‚   â”‚
â”‚  â”‚  â”‚ IF mismatch_pct > threshold â†’ STOP! â”‚                                         â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚   â”‚
â”‚  â”‚                                                                                   â”‚   â”‚
â”‚  â”‚  Time: ~15-20 minutes                                                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â”‚                                                                               â”‚
â”‚         â–¼                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ PHASE 3: COLUMN-LEVEL EXTRACTION (Java Streaming)                                â”‚   â”‚
â”‚  â”‚                                                                                   â”‚   â”‚
â”‚  â”‚  JDBC Streaming Query (fetchSize=10000):                                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ SELECT 'source' as KEY, s.*                                              â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ FROM source_table s                                                      â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ WHERE posn_id IN (SELECT posn_id FROM dc_mismatch_keys)                  â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ UNION ALL                                                                â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ SELECT 'target' as KEY, t.*                                              â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ FROM target_table t                                                      â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ WHERE posn_id IN (SELECT posn_id FROM dc_mismatch_keys)                  â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ ORDER BY posn_id, KEY                                                    â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                                                                                   â”‚   â”‚
â”‚  â”‚         â”‚                                                                         â”‚   â”‚
â”‚  â”‚         â”‚ Stream pairs (source row, target row)                                  â”‚   â”‚
â”‚  â”‚         â”‚                                                                         â”‚   â”‚
â”‚  â”‚         â–¼                                                                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚                      CSV / EXCEL OUTPUT                                  â”‚    â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚   â”‚
â”‚  â”‚  â”‚ KEY    â”‚ posn_id â”‚ col1    â”‚ col2     â”‚ col3   â”‚ ...                    â”‚    â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚   â”‚
â”‚  â”‚  â”‚ source â”‚ 456     â”‚ 100.50  â”‚ ACTIVE   â”‚ John   â”‚ ...                    â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ target â”‚ 456     â”‚ [100.55]â”‚ [INACTV] â”‚ John   â”‚ ...   â† RED CELLS     â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ source â”‚ 789     â”‚ 200.00  â”‚ PENDING  â”‚ Jane   â”‚ ...                    â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ target â”‚ 789     â”‚ (null)  â”‚ (null)   â”‚ (null) â”‚ ...   â† MISSING       â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                                                                                   â”‚   â”‚
â”‚  â”‚  Time: ~60-90 minutes                                                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â”‚                                                                               â”‚
â”‚         â–¼                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ PHASE 4: EMAIL NOTIFICATION                                                      â”‚   â”‚
â”‚  â”‚                                                                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚  ğŸ“§ To: analyst@company.com                                              â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  Subject: âœ… Data Comparison COMPLETED - Job DC_20240331_143022          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                                                                          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  Source Records: 28,000,000                                              â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  Target Records: 28,000,000                                              â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  Mismatches: 8,400,000 (30.00%)                                          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  Duration: 02:15:32                                                      â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                                                                          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  [Download Report]                                                       â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                                                                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                         â”‚
â”‚  TOTAL TIME: ~2-2.5 hours                                                              â”‚
â”‚                                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Database Schema

### Tables

```sql
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          DATABASE SCHEMA                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  DC_COMPARISON_CONFIG                                                       â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                       â”‚
â”‚  Stores job configuration and results                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Column              â”‚ Type         â”‚ Description                      â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ config_id           â”‚ NUMBER (PK)  â”‚ Auto-generated ID                â”‚  â”‚
â”‚  â”‚ job_id              â”‚ VARCHAR2(100)â”‚ Unique job identifier            â”‚  â”‚
â”‚  â”‚ source_table        â”‚ VARCHAR2(128)â”‚ Source table name                â”‚  â”‚
â”‚  â”‚ target_table        â”‚ VARCHAR2(128)â”‚ Target table name                â”‚  â”‚
â”‚  â”‚ source_db_link      â”‚ VARCHAR2(128)â”‚ DB link for source (nullable)    â”‚  â”‚
â”‚  â”‚ target_db_link      â”‚ VARCHAR2(128)â”‚ DB link for target (nullable)    â”‚  â”‚
â”‚  â”‚ source_as_of        â”‚ DATE         â”‚ Source as_of filter              â”‚  â”‚
â”‚  â”‚ target_as_of        â”‚ DATE         â”‚ Target as_of filter              â”‚  â”‚
â”‚  â”‚ source_dataset_id   â”‚ VARCHAR2(100)â”‚ Source dataset_id filter         â”‚  â”‚
â”‚  â”‚ target_dataset_id   â”‚ VARCHAR2(100)â”‚ Target dataset_id filter         â”‚  â”‚
â”‚  â”‚ threshold_pct       â”‚ NUMBER(5,2)  â”‚ Mismatch threshold (default 30)  â”‚  â”‚
â”‚  â”‚ user_email          â”‚ VARCHAR2(256)â”‚ Email for notification           â”‚  â”‚
â”‚  â”‚ parallel_degree     â”‚ NUMBER       â”‚ Parallel threads (default 16)    â”‚  â”‚
â”‚  â”‚ batch_size          â”‚ NUMBER       â”‚ Batch size (default 100000)      â”‚  â”‚
â”‚  â”‚ status              â”‚ VARCHAR2(20) â”‚ PENDING/RUNNING/COMPLETED/FAILED â”‚  â”‚
â”‚  â”‚ total_source_count  â”‚ NUMBER       â”‚ Total source records             â”‚  â”‚
â”‚  â”‚ total_target_count  â”‚ NUMBER       â”‚ Total target records             â”‚  â”‚
â”‚  â”‚ mismatch_count      â”‚ NUMBER       â”‚ Number of mismatches             â”‚  â”‚
â”‚  â”‚ mismatch_pct        â”‚ NUMBER(5,2)  â”‚ Mismatch percentage              â”‚  â”‚
â”‚  â”‚ threshold_exceeded  â”‚ CHAR(1)      â”‚ Y/N flag                         â”‚  â”‚
â”‚  â”‚ output_file_path    â”‚ VARCHAR2(1K) â”‚ Path to output file              â”‚  â”‚
â”‚  â”‚ created_at          â”‚ TIMESTAMP    â”‚ Job creation time                â”‚  â”‚
â”‚  â”‚ started_at          â”‚ TIMESTAMP    â”‚ Job start time                   â”‚  â”‚
â”‚  â”‚ completed_at        â”‚ TIMESTAMP    â”‚ Job completion time              â”‚  â”‚
â”‚  â”‚ error_message       â”‚ CLOB         â”‚ Error details if failed          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚  DC_HASH_SOURCE / DC_HASH_TARGET                                            â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                            â”‚
â”‚  Temporary storage for computed hashes                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Column              â”‚ Type         â”‚ Description                      â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ posn_id             â”‚ VARCHAR2(100)â”‚ Position identifier              â”‚  â”‚
â”‚  â”‚ as_of               â”‚ DATE         â”‚ As of date                       â”‚  â”‚
â”‚  â”‚ dataset_id          â”‚ VARCHAR2(100)â”‚ Dataset identifier               â”‚  â”‚
â”‚  â”‚ row_hash            â”‚ RAW(32)      â”‚ SHA256 hash of non-LOB columns   â”‚  â”‚
â”‚  â”‚ row_num             â”‚ NUMBER       â”‚ Row number for duplicates        â”‚  â”‚
â”‚  â”‚ clob_hash           â”‚ RAW(32)      â”‚ Hash of CLOB columns             â”‚  â”‚
â”‚  â”‚ blob_hash           â”‚ RAW(32)      â”‚ Hash of BLOB columns             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  PK: (posn_id, as_of, dataset_id, row_num)                                  â”‚
â”‚  Options: NOLOGGING (faster inserts)                                        â”‚
â”‚                                                                             â”‚
â”‚  DC_MISMATCH_KEYS                                                           â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                           â”‚
â”‚  Stores keys of mismatched records                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Column              â”‚ Type         â”‚ Description                      â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ job_id              â”‚ VARCHAR2(100)â”‚ Job identifier                   â”‚  â”‚
â”‚  â”‚ posn_id             â”‚ VARCHAR2(100)â”‚ Position identifier              â”‚  â”‚
â”‚  â”‚ as_of               â”‚ DATE         â”‚ As of date                       â”‚  â”‚
â”‚  â”‚ dataset_id          â”‚ VARCHAR2(100)â”‚ Dataset identifier               â”‚  â”‚
â”‚  â”‚ source_row_num      â”‚ NUMBER       â”‚ Source row number                â”‚  â”‚
â”‚  â”‚ target_row_num      â”‚ NUMBER       â”‚ Target row number                â”‚  â”‚
â”‚  â”‚ mismatch_type       â”‚ VARCHAR2(30) â”‚ HASH_MISMATCH/MISSING_IN_*       â”‚  â”‚
â”‚  â”‚ created_at          â”‚ TIMESTAMP    â”‚ Record creation time             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚  DC_COMPARISON_LOG                                                          â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                          â”‚
â”‚  Audit log for job execution                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Column              â”‚ Type         â”‚ Description                      â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ log_id              â”‚ NUMBER (PK)  â”‚ Auto-generated ID                â”‚  â”‚
â”‚  â”‚ job_id              â”‚ VARCHAR2(100)â”‚ Job identifier                   â”‚  â”‚
â”‚  â”‚ phase               â”‚ VARCHAR2(50) â”‚ INIT/HASH_SOURCE/COMPARE/etc.    â”‚  â”‚
â”‚  â”‚ message             â”‚ VARCHAR2(4K) â”‚ Log message                      â”‚  â”‚
â”‚  â”‚ records_processed   â”‚ NUMBER       â”‚ Records processed in this phase  â”‚  â”‚
â”‚  â”‚ elapsed_seconds     â”‚ NUMBER       â”‚ Time taken for this phase        â”‚  â”‚
â”‚  â”‚ created_at          â”‚ TIMESTAMP    â”‚ Log timestamp                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Key Algorithms

### 1. Hash Computation Algorithm

```sql
-- Hash is computed by concatenating all column values with delimiter
-- NULL values are replaced with CHR(0) to differentiate from empty string

STANDARD_HASH(
    NVL(TO_CHAR(col1), CHR(0)) || '|' ||
    NVL(TO_CHAR(ROUND(col2, 5), 'FM999999999999990.00000'), CHR(0)) || '|' ||
    NVL(TO_CHAR(col3, 'YYYY-MM-DD HH24:MI:SS'), CHR(0)) || '|' ||
    ... (for all 700 columns)
, 'SHA256')

-- For CLOB/BLOB columns, use DBMS_CRYPTO separately:
DBMS_CRYPTO.HASH(clob_column, DBMS_CRYPTO.HASH_SH256)
```

### 2. Duplicate Handling Algorithm

```sql
-- When multiple rows have same posn_id, assign row numbers
-- Then compare source row 1 with target row 1, source row 2 with target row 2, etc.

ROW_NUMBER() OVER (
    PARTITION BY posn_id, as_of, dataset_id
    ORDER BY ROWID  -- or any deterministic column
) as row_num
```

### 3. Value Comparison Rules

```java
// In Java StreamingExportService.valuesEqual()

boolean valuesEqual(Object val1, Object val2, ColumnMetadata col) {
    // Rule 1: NULL = NULL is a MATCH
    if (val1 == null && val2 == null) return true;

    // Rule 2: NULL vs non-NULL is a MISMATCH
    if (val1 == null || val2 == null) return false;

    // Rule 3: For numbers, round to 5 decimal places
    if (col.isNumeric()) {
        BigDecimal bd1 = new BigDecimal(val1.toString())
            .setScale(5, RoundingMode.HALF_UP);
        BigDecimal bd2 = new BigDecimal(val2.toString())
            .setScale(5, RoundingMode.HALF_UP);
        return bd1.compareTo(bd2) == 0;
    }

    // Rule 4: For strings, exact match (empty string != NULL)
    return val1.toString().equals(val2.toString());
}
```

---

## Performance Optimizations

### Oracle-Side Optimizations

| Optimization | Implementation | Benefit |
|--------------|----------------|---------|
| Parallel Execution | `DBMS_PARALLEL_EXECUTE` with 16 threads | 16x faster hash computation |
| NOLOGGING Tables | `CREATE TABLE ... NOLOGGING` | 50% faster inserts (no redo) |
| Append Hint | `INSERT /*+ APPEND PARALLEL(16) */` | Direct path insert |
| Hash Join | `/*+ USE_HASH(s t) */` | Faster than nested loops for large data |
| Bulk Operations | `BULK COLLECT`, `FORALL` | Reduced context switches |
| In-DB Hashing | `STANDARD_HASH()` function | No data transfer to Java |

### Java-Side Optimizations

| Optimization | Implementation | Benefit |
|--------------|----------------|---------|
| Streaming JDBC | `fetchSize=10000`, `TYPE_FORWARD_ONLY` | No full result set in memory |
| Buffered I/O | `BufferedWriter` with 1MB buffer | Reduced disk I/O |
| Streaming Excel | `SXSSFWorkbook` with 1000 row window | Excel for millions of rows |
| Connection Pool | HikariCP with 20 connections | No connection overhead |
| Async Processing | `@Async` with thread pool | Non-blocking API response |

### Memory Configuration

```bash
# JVM options for large datasets
java -Xmx8g -Xms4g \
     -XX:+UseG1GC \
     -XX:MaxGCPauseMillis=200 \
     -XX:+ParallelRefProcEnabled \
     -jar data-comparison-tool.jar
```

---

## Configuration

### Application Configuration (`application.yml`)

```yaml
# Database
datasource:
  url: jdbc:oracle:thin:@hostname:1521:ORCL
  username: ${DB_USERNAME}
  password: ${DB_PASSWORD}
  pool:
    size: 20

# Comparison Settings
comparison:
  parallel:
    threads: 8              # Java threads (Oracle uses 16)
  fetch:
    size: 10000             # JDBC fetch size
  output:
    dir: /data/comparison   # Output directory
    format: CSV             # CSV or EXCEL
  decimal:
    precision: 5            # Decimal places for comparison

# Email
mail:
  host: smtp.company.com
  port: 587
  from: noreply@company.com
  enabled: true
```

### Environment Variables

```bash
# Required
export DB_URL=jdbc:oracle:thin:@hostname:1521:ORCL
export DB_USERNAME=comparison_user
export DB_PASSWORD=secure_password

# Optional
export PARALLEL_THREADS=8
export FETCH_SIZE=10000
export OUTPUT_DIR=/data/comparison
export OUTPUT_FORMAT=CSV
export DECIMAL_PRECISION=5
export MAIL_HOST=smtp.company.com
export MAIL_FROM=noreply@company.com
```

---

## API Reference

### Start Comparison

```http
POST /api/v1/comparison/start
Content-Type: application/json

{
  "sourceTable": "SCHEMA.POSITIONS",
  "targetTable": "SCHEMA.POSITIONS",
  "sourceDbLink": null,
  "targetDbLink": "TARGET_DB_LINK",
  "sourceAsOf": "2024-03-31",
  "targetAsOf": "2024-03-31",
  "sourceDatasetId": "14_03312",
  "targetDatasetId": "14_03312",
  "thresholdPercent": 30.0,
  "userEmail": "analyst@company.com",
  "parallelDegree": 16,
  "batchSize": 100000
}
```

**Response:**
```json
{
  "jobId": "DC_20240331_143022_ABC123",
  "status": "STARTED"
}
```

### Check Status

```http
GET /api/v1/comparison/status/{jobId}
```

**Response:**
```json
{
  "jobId": "DC_20240331_143022_ABC123",
  "status": "COMPLETED",
  "totalSourceCount": 28000000,
  "totalTargetCount": 28000000,
  "mismatchCount": 8400000,
  "mismatchPercent": 30.0,
  "thresholdExceeded": false,
  "hashMismatchCount": 8000000,
  "missingInTargetCount": 300000,
  "missingInSourceCount": 100000,
  "outputFilePath": "/data/comparison/comparison_DC_20240331_143022.csv",
  "downloadUrl": "https://server/download/comparison_DC_20240331_143022.csv",
  "startedAt": "2024-03-31T14:30:22",
  "completedAt": "2024-03-31T16:45:54",
  "elapsedSeconds": 8132
}
```

### Download Report

```http
GET /api/v1/comparison/download/{jobId}
```

**Response:** Binary file (CSV or Excel)

---

## Deployment Guide

### Prerequisites

1. **Oracle Database 12c+** with:
   - `DBMS_PARALLEL_EXECUTE` privilege
   - `DBMS_CRYPTO` privilege
   - Adequate temp tablespace (10GB+)
   - `parallel_max_servers >= 64`

2. **Java 17+** runtime

3. **SMTP Server** for email notifications

### Step-by-Step Deployment

```bash
# 1. Clone/copy the project
cd /opt/applications
unzip data-comparison-tool.zip

# 2. Install Oracle objects
sqlplus comparison_user/password@ORCL
SQL> @sql/01_create_types_and_tables.sql
SQL> @sql/02_comparison_package_spec.sql
SQL> @sql/03_comparison_package_body.sql
SQL> exit

# 3. Grant privileges
sqlplus sys/password@ORCL as sysdba
SQL> GRANT EXECUTE ON DBMS_PARALLEL_EXECUTE TO comparison_user;
SQL> GRANT EXECUTE ON DBMS_CRYPTO TO comparison_user;
SQL> exit

# 4. Configure environment
export DB_URL=jdbc:oracle:thin:@hostname:1521:ORCL
export DB_USERNAME=comparison_user
export DB_PASSWORD=secure_password
export OUTPUT_DIR=/data/comparison
export MAIL_HOST=smtp.company.com

# 5. Create output directory
mkdir -p /data/comparison
chown appuser:appgroup /data/comparison

# 6. Start application
java -Xmx8g -Xms4g -jar data-comparison-tool.jar

# 7. Verify health
curl http://localhost:8080/api/v1/comparison/health
```

### Running as a Service (systemd)

```ini
# /etc/systemd/system/data-comparison.service
[Unit]
Description=Data Comparison Tool
After=network.target

[Service]
Type=simple
User=appuser
Environment="DB_URL=jdbc:oracle:thin:@hostname:1521:ORCL"
Environment="DB_USERNAME=comparison_user"
Environment="DB_PASSWORD=secure_password"
Environment="OUTPUT_DIR=/data/comparison"
ExecStart=/usr/bin/java -Xmx8g -Xms4g -jar /opt/applications/data-comparison-tool.jar
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

```bash
# Enable and start
sudo systemctl enable data-comparison
sudo systemctl start data-comparison
sudo systemctl status data-comparison
```

---

## Monitoring & Troubleshooting

### Monitor Job Progress

```sql
-- Check job status
SELECT job_id, status, mismatch_count, mismatch_pct,
       ROUND((SYSTIMESTAMP - started_at) * 24 * 60, 2) as elapsed_minutes
FROM dc_comparison_config
WHERE job_id = 'DC_20240331_143022_ABC123';

-- Check phase timing
SELECT phase, message, records_processed, elapsed_seconds
FROM dc_comparison_log
WHERE job_id = 'DC_20240331_143022_ABC123'
ORDER BY created_at;

-- Check parallel execution
SELECT * FROM V$PX_PROCESS_SYSSTAT WHERE STATISTIC LIKE '%Servers%';

-- Check temp tablespace
SELECT tablespace_name,
       ROUND(SUM(bytes_used)/1024/1024/1024, 2) as used_gb,
       ROUND(SUM(bytes_free)/1024/1024/1024, 2) as free_gb
FROM V$TEMP_SPACE_HEADER
GROUP BY tablespace_name;
```

### Common Issues

| Issue | Cause | Solution |
|-------|-------|----------|
| Job stuck at HASH_SOURCE | Slow disk I/O | Increase parallel_degree |
| ORA-12801 parallel error | Insufficient parallel servers | `ALTER SYSTEM SET parallel_max_servers=64` |
| Out of temp space | Large intermediate results | Add temp files |
| Java OOM | Large result set | Reduce fetchSize, use CSV |
| Slow Excel generation | Too many rows | Use CSV for >1M mismatches |

### Log Files

```bash
# Application logs
tail -f /opt/applications/logs/data-comparison.log

# Oracle alert log
tail -f $ORACLE_BASE/diag/rdbms/ORCL/ORCL/trace/alert_ORCL.log
```

---

## Appendix: Complete File Structure

```
data-comparison-tool/
â”œâ”€â”€ sql/
â”‚   â”œâ”€â”€ 01_create_types_and_tables.sql    # Database objects
â”‚   â”œâ”€â”€ 02_comparison_package_spec.sql    # PL/SQL package specification
â”‚   â”œâ”€â”€ 03_comparison_package_body.sql    # PL/SQL package body
â”‚   â””â”€â”€ 04_optimized_extraction_query.sql # Extraction queries
â”œâ”€â”€ src/main/java/com/datacompare/
â”‚   â”œâ”€â”€ DataCompareApplication.java       # Spring Boot main class
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ DataCompareConfig.java        # Configuration beans
â”‚   â”œâ”€â”€ controller/
â”‚   â”‚   â””â”€â”€ ComparisonController.java     # REST endpoints
â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â”œâ”€â”€ ComparisonRequest.java        # Request DTO
â”‚   â”‚   â”œâ”€â”€ ComparisonResult.java         # Response DTO
â”‚   â”‚   â””â”€â”€ ColumnMetadata.java           # Column info DTO
â”‚   â””â”€â”€ service/
â”‚       â”œâ”€â”€ ComparisonService.java        # Main orchestration
â”‚       â”œâ”€â”€ StreamingExportService.java   # CSV/Excel export
â”‚       â””â”€â”€ EmailService.java             # Email notifications
â”œâ”€â”€ src/main/resources/
â”‚   â””â”€â”€ application.yml                   # Configuration
â”œâ”€â”€ pom.xml                               # Maven dependencies
â”œâ”€â”€ README.md                             # Quick start guide
â””â”€â”€ ARCHITECTURE.md                       # This document
```

---

**Document Version:** 1.0
**Last Updated:** 2024-03-31
**Author:** Data Platform Team
